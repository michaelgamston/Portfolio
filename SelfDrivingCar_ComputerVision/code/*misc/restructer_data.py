import os
import numpy as np
import pandas as pd
import shutil


#! IMPORTANT !!
# make sure the training data file structure is as follows data/training_data/training_data

#! WARNING !! 
# the first part of the notebook won't work as the files are now in a different place


ignore = [4895, 3999, 8285, 10171, 3141, 3884]
dict_ig = {0.0625:[], 0.125:[1845,5705,7443], 0.1875:[1742,5446,8359,13132,13169,13621], 0.25:[90,313,562,720,883,1019,1021,6141,6848,6852,7361,7720,8173,9054,9132,9459,9483,10615,10896,11914,11982,12782], 0.3125:[22,67,163,460,928,954,1022,1462,1468,1481,1600,1835,1869,1901,1956,1957,1998,2173,2229,2392,2627,3007,3099,3237,3303,3464,3505,3548,3594,3612,3777,3782,4000,4183,4916,5065,5465,5713,5729,5975,6085,6196,6026,6258,6273,6605,6619,6700,6851,7223,7308], 0.375:[84,153,260,265,308,334,381,574,605,629,709,1001,1036,1107,1128,1131,1140,1154,1225,1273,1666,2359,2537,2595,2695,2885,3428,3557,3883,4281,4852,4929,4992,5522,5563,5830,6035,6121,6153,6194,6280,7829,7850,7990,8157,8335,8739,8801,8856,8892,9045,9048,9086,9138,9164,9291,9487,9490,9669,10033,10129,10409,10680,11162,11191,11673,11754,12465,12848,13229,11537,11685,12152,12601,12850,11667,11692,12295,12684,12988], 0.4375:[294,439,1053,1080,1157,1237,1291,1336,1359,1377,2349,2673,2690,2700,2712,2747,2949,2955,2958,3083,3180,3486,3473,3273,3486,3493,3510,3516,3635,3885,3910,3947,4083,4126,4221,4279,4284,4290,4320,4346,4534,4596,4597,4793,4807,4868,4875,4957,5042,5270,5362,5425,5462,5612,5816,5949,5985,5994,6205,6378,6473,6856,6940,7053,7369,7455,7517,7692,7748,7860,7867,7885,7949,7994,8151,8217,8227,8242,8262,8284,8343,8349,8417,8612,8686,8790,8858,8932,9094,9124,9160,9228,9410,9425,9497,9503,9581,9709,9734,9797,9853,9900,10074,10125,10252,10329,10512,11163,11165,11167,11183,11239,11292,11307,11704,11766,11946,12008,12136,12206,12239,12281,12331,12333,12356,12360,12437,12454,12695,12696,12841,12917,13018,13090,13311,13363,13447,13541,13543,13720,13724,13761], 0.5:[89,276,476,480,507,602,603,617,995,1231,1306,1515,1570,1686,1893,1981,2291,2442,2525,2530,2543,2643,2808,2851,2987,3210,3284,3517,3536,3540,3642,3700,3721,4110,4111,4192,4399,4667,4861,5034,5078,5165,5197,5458,5736,5805,5838,5923,5942,6022,6444,6565,6610,6664,6742,6820,6978,7143,7155,7168,7309,7352,7358,7436,8044,8050,8086,8170,8198,8261,8318,8547,8575,8726,8782,8895,8983,9093,9224,9230,9699,9724,9839,9997,10077,10097,10108,10228,10268,10332,10350,10382,10421,10481,10541,10908,10921,10951,10997,11000,11404,11538,11548,11563,11684,11703,11710,11874,11958,11958,12048,12085,12104,12151,12236,12280,12442,12451,12525,12584,12770,12805,12853,13052,13067,13070,13146,13167,13198,13267,13277,13283,13301,13397,13604,13610,13637,13691,13739], 0.5625:[32,94,103,109,232,277,504,586,715,969,1072,2188,6990], 0.625:[], 0.6875:[7964], 0.75:[9145], 0.8125:[4495,5638], 0.875:[12531], 0.9375:[13362], 1:[8921]}
ignore.extend(list(dict_ig.values()))

#fileNames = os.listdir('data/training_data/training_data/')
meta_data = pd.read_csv('./data/big_data/updated_training_norm-15452.csv')

categories_angle = [0.0, 0.0625, 0.125, 0.1875, 0.25, 0.3125, 0.375, 0.4375, 0.5, 0.5625, 0.625, 0.6875, 0.75, 0.8125, 0.875, 0.9375, 1.0]
categories_speed = [0, 1]
    
# number of elements 13793
# 15% validation 85% training 
# 2069 for validation

#match number number of elements in angle categories with speed 1 to number of elements in angle categories with speed 0 


os.makedirs(f'data/big_data/speed/0')
os.makedirs(f'data/big_data/speed/1')


for angle in categories_angle: 
    os.makedirs(f'data/big_data/angle/{angle}')

    

angle_count = {0.0:0, 0.0625:0, 0.125:0, 0.1875:0, 0.25:0, 0.3125:0, 0.375:0, 0.4375:0, 0.5:0, 0.5625:0, 0.625:0, 0.6875:0, 0.75:0, 0.8125:0, 0.875:0, 0.9375:0, 1.0:0}
speed_count = {0:0, 1:0}

for index, row in meta_data.iterrows():

    image_name = int(row['image_id'])
  
    if image_name not in ignore:
        
        image_metadata = [row['angle'], row['speed']]
        
        #new_cat = categories.index(image_metadata)
        
        source = f'data/big_data/training_data/training_data/{image_name}.png'
        angle = row['angle']
        speed = int(row['speed'])

        # if np.random.random() >= 0.1:
        #     destination = f'data/test_angle/{angle}/{image_name}.png'
        #     shutil.copy(source, destination)
        #     destination = f'data/test_speed/{speed}/{image_name}.png'
        #     shutil.copy(source, destination)
        # else:
        
        #if angle_count[angle] < 150: 
        destination_angle = f'data/big_data/angle/{angle}/{image_name}.png'
        shutil.copy(source, destination_angle) 
            #angle_count[angle]+=1
            
        #if speed_count[speed] < 3390:
        destination_speed = f'data/big_data/speed/{speed}/{image_name}.png'
        shutil.copy(source, destination_speed) 
            #speed_count[speed]+=1
            
        